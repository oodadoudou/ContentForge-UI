============================================================
模块三: 电子书工坊 (03_ebook_workshop)
【简介】
本模块是您的电子书“创作中心”，提供了一系列强大的工具，用于
从零创建、编辑、分割和美化电子书（EPUB/TXT/HTML）文件。

【使用方法】
本模块的所有功能都已整合到主菜单中。

在终端中，运行 python main.py。

在主菜单选择 "3. 电子书处理与生成 (TXT/EPUB/HTML)"。

根据子菜单的提示选择您需要的功能。

--------------------- 功能与用法详解 ---------------------

--- 创建与转换 ---
1. [创建] 从 TXT 创建带章节目录的 EPUB (⭐新增样式选择)

对应脚本: txt_to_epub_convertor.py

功能: 能够智能地将一个纯文本（TXT）文件转换为一个带有封面、章节目录、可自定义样式的标准 EPUB 电子书。

✨ 最新功能升级 (v2.0):
- 🎨 5种精美样式选择：经典简约、温馨护眼、现代清新、优雅古典、简洁现代
- 👀 实时样式预览：选择样式后可在浏览器中预览效果
- 📐 统一字体规范：所有样式采用统一的字体大小设置（p=1em, h1=1.3em, h2=1.25em等）
- 📖 段落首行缩进：所有样式均支持2em首行缩进，提升阅读体验
- 🎯 目录样式优化：深灰色字体、无序号、鼠标悬停显示下划线
- 🖼️ 自定义封面：支持上传自定义封面图片
- 🔧 智能章节识别：自动检测和处理章节结构

样式特色:
- 经典简约：传统serif字体，蓝色标题边框，适合正式文档
- 温馨护眼：暖色调设计，棕色装饰线，护眼阅读体验
- 现代清新：sans-serif字体，彩色左边框，现代简洁风格
- 优雅古典：古典边框设计，棕色主题，典雅大方
- 简洁现代：极简设计，大写标题，干净利落

准备工作: 为了让脚本能正确识别目录，您需要使用特定格式来标记章节标题。脚本默认的规则是：

一级标题: 以 # 标题 的形式 (例如: # 第1章)

二级标题: 以 ## 标题 的形式 (例如: ## 1.1 小节)
【注意】: # 或 ## 必须位于一行的开头。

使用流程:
1. 运行脚本，选择要转换的TXT文件
2. 从5种样式中选择您喜欢的EPUB样式
3. 可选择在浏览器中预览样式效果
4. 设置书籍基本信息（标题、作者等）
5. 可选择上传自定义封面图片
6. 生成带有精美样式的EPUB文件

2. [创建] 将 Markdown 文件夹批量转为 HTML

对应脚本: convert_md_to_html.py

功能: 将指定目录下的所有 Markdown (.md) 文件，批量转换为带有美观样式和代码高亮的、自包含的 HTML 文件。

3. [转换] 从 EPUB 提取纯文本内容 (TXT)

对应脚本: epub_to_txt_convertor.py

功能: 将 EPUB 文件中的所有章节内容提取出来，合并成一个单一的、干净的 TXT 文件，便于存档或二次编辑。

--- 编辑与修复 EPUB ---
4. (元数据) 批量重命名 EPUB 文件

对应脚本: epub_rename.py

区别与用途: 此工具只修改文件名，不改变 EPUB 内部的任何内容。它会读取 EPUB 文件内部的元数据标题，然后让您选择：

手动输入新标题：为您选定的文件设置一个全新的文件名。

自动规整：直接使用书内原有的标题，清理掉特殊字符，生成一个干净、标准的文件名。

适用场景: 当你的 EPUB 文件名是 123.epub 或 download.epub 这种无意义的名称时，用它来快速整理文件名。

5. (内容) 仅将 EPUB 内文转为简体中文

对应脚本: epub_convert_tc_to_sc.py

区别与用途: 这是一个单一功能的转换工具。它只会将 EPUB 文件内的所有文本内容从繁体中文转换为简体中文。

适用场景: 当你拿到一个排版已经很完美的繁体中文 EPUB，并且你只想进行文字简繁转换，不希望触碰任何排版和格式时使用。

6. (综合) 修复竖排版并转为简体中文 (⭐推荐)

对应脚本: epub_reformat_and_convert_v2.py

区别与用途: 这是一个智能的、多合一的处理工具。它会自动检测 EPUB 文件是否存在以下两种问题，然后按需进行修复：

版式问题: 检测是否存在从右向左翻页的“竖排版”格式，并将其修正为通用的从左向右翻页的“横排版”。

文字问题: 检测内容是否为繁体中文，并将其转换为简体。

适用场景: 这是最常用、最推荐的修复选项。当你拿到一个从日本或台湾网站下载的、不确定其内部格式的 EPUB 文件时，直接使用此功能，它能一步到位解决最常见的两大格式问题。

7. (清理) EPUB 清理工具 (封面/字体)

对应脚本: epub_cleaner.py

区别与用途: 这是一个多功能的 EPUB 清理工具，支持三种操作模式：

[f] 删除字体: 删除 EPUB 中的所有字体文件（.ttf, .otf, .woff 等）和 CSS 样式中的字体声明（@font-face, font-family 等），让阅读器使用系统默认字体。

[c] 删除封面: 彻底移除 EPUB 文件中的封面图片和封面页面，并清理相关的元数据、清单（manifest）和书脊（spine）条目。

[b] 删除两者: 同时执行封面删除和字体删除操作。

适用场景: 
- 字体删除：当 EPUB 内置字体导致显示异常，或希望统一使用阅读器字体时。
- 封面删除：需要减小文件体积，或不希望看到多余的封面页时。
- 组合操作：全面清理 EPUB 文件，获得最干净的阅读体验。

--- 高级工具 ---
8. 根据规则批量替换 EPUB/TXT 内容 (⭐全新升级)

对应脚本: batch_replacer.py

功能: 根据您预先定义的规则，批量替换指定目录内所有 EPUB 和 TXT 文件中的文本内容，并生成美观的交互式HTML报告。

✨ 最新改进 (v2.0):
- 🎨 全新粉色主题设计：现代化的粉蓝色渐变背景，美观大方
- 📊 交互式报告：可折叠的规则组，点击展开查看详细替换实例
- 📱 响应式设计：完美适配桌面和移动设备
- 🔝 返回顶部按钮：智能显示/隐藏，平滑滚动体验
- 🏗️ 模块化架构：HTML/CSS/JS代码分离到shared_assets目录，便于维护
- 🎯 智能路径处理：自动检测文件位置，确保样式正确加载

准备工作:

在 shared_assets 文件夹中找到 rules.txt 模板文件。

将其【复制】到您将要处理的电子书所在的目录。

根据您的需求，修改该目录下的 rules.txt 文件。

报告特色:
- 统计卡片显示替换规则总数和实例总数
- 每个规则组可独立展开/折叠查看替换详情
- 高亮显示原文和修改后的文本差异
- 生成时间戳和完整的处理记录

9. 用统一的 CSS 样式美化 EPUB

对应脚本: epub_styler.py

功能: 使用项目 shared_assets 文件夹中的 new_style.css 文件，一键统一替换指定目录内所有 EPUB 文件的内部样式，实现风格的统一。

10. 按章节数量均等分割 EPUB 文件

对应脚本: split_epub.py

功能: 将一个大型的 EPUB 文件，按您指定的卷数（parts）平均分割成多个独立的小卷。

11. 合并文件夹内所有 EPUB

对应脚本: epub_merge.py

功能: 将指定文件夹内的所有 EPUB 文件，按文件名顺序合并成一个单一的、带有层级目录的 EPUB 文件。合并后的书籍将以第一本书的封面作为主封面。

适用场景: 当您想将一个系列的书籍（如：第一卷、第二卷、第三卷）合并成一部完整的选集，以便于阅读和管理时使用。

12. [工具] 解包/打包 EPUB

对应脚本: epub_toolkit.py

功能: 提供两个功能：1. 将EPUB文件解包成一个包含其所有内部文件（HTML, CSS, 图片等）的文件夹。2. 将一个符合EPUB结构的文件夹重新打包成一个EPUB文件。

适用场景: 当你需要手动编辑EPUB的内部文件，例如修改HTML结构、替换图片或调整CSS，但又不想使用重量级的EPUB编辑软件时，这个工具非常有用。

13. 标点符号补全工具 (TXT/EPUB) (⭐智能识别)

对应脚本: punctuation_fixer.py

功能: 智能补全中文文本中缺失的标点符号，专注于逗号补全，避免对非正文内容进行错误处理。

✨ 核心特性:
- 🧠 智能内容识别：自动跳过标题、目录、作者信息、版权信息等非正文内容
- 📝 专注逗号补全：只补全段落中缺失的逗号，不添加句号，避免过度修改
- 📊 详细比较报告：生成美观的HTML报告，展示所有修改内容的前后对比
- 📚 支持多种格式：同时支持TXT和EPUB文件的批量处理
- 🎯 精准规则匹配：基于中文语法规则，智能判断逗号添加位置

智能识别规则:
- 跳过章节标题（如"第一章"、"序言"等）
- 跳过作者、版权、出版信息
- 跳过目录内容（包含大量省略号或间隔符的行）
- 跳过页眉页脚和页码信息
- 只对长度适中的正文段落进行处理

标点补全规则:
- 中文字符间有空格时添加逗号
- 对话前适当添加逗号
- 长句中适当位置添加逗号分隔
- 数字与单位间去除多余空格

适用场景: 
- 处理从OCR识别或网络抓取的中文文本，这些文本往往缺少标点符号
- 修复扫描版电子书转换后的标点符号问题
- 批量处理需要标点符号规范化的中文文档
- 需要保持原文结构，只进行最小化标点补全的场景

使用流程:
1. 运行脚本，选择要处理的文件或文件夹
2. 脚本自动识别正文内容，跳过非正文部分
3. 根据中文语法规则智能添加逗号
4. 生成详细的HTML比较报告
5. 查看报告确认修改效果，原文件保持不变